<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>职来志趣</title>
	<link rel="stylesheet" href="style/jquery.mobile-1.4.5.css">
	<link rel="stylesheet" type="text/css" href="style/jquery.fullPage.css" />
	<link rel="stylesheet" href="style/theme_zlzw.css">
	<style type="text/css">

		#zyjs_list .ui-first-child{
			background: rgb(246, 246, 246);
			border: 0px;
		}

		#zyjs_list .desc{
			font-family: 'Microsoft YaHei',sans-serif;
			font-size: 12px;
			font-weight: normal;
		}

		#zyjs_list .title{
			font-family: 'Microsoft YaHei',sans-serif;
			font-size: 14px;
			font-weight: bold;
		}

		#zyjs_list .author{
			font-family: 'Microsoft YaHei',sans-serif;
			font-size: 12px;
			font-weight: normal;
		}

		#zyjs_popup_header h1{
			font-size: 16px;
			font-weight: normal;

		}

		#zyjs_popup_header h5{
			font-size: 12px;
			font-weight: normal;
		}

		#gkzy_score{
			font-size: 12px;
  			padding: 0px;
  			line-height: 12px;
  			vertical-align: top;
  			position: relative;
  			top: -2px;
		}

		.zlzq-select-menu{
			-webkit-appearance: button;
			border: 0px;
  			background: transparent;
			color: #FFF;
			font-size: 12px;
  			font-weight: normal;
  			max-width: 100%;
		}

		#statisticsLegend{
			font-size: 12px;
			font-family: Microsoft YaHei,SimHei;
		}

		.legend-color{
			font-size: 1em;
			line-height: 1.2em;
		}

		.legend-text{
			font-size: 1em;
			line-height: 1.2em;
			color: white;
		}

		#share-btn{
			background-color: transparent;
  			border: 0px;
		}

		.share-to{
			font-size: 12px;
			color: #b4b4b4!important;
			text-decoration: none;
		}

		.share-to img{
			height: 1em;
		}
    
        .share {
              padding: 0px .5em;
        }

		#fullpage .content{
			height: 100%;
			position: relative;
		}

		#fullpage img{
			height: 100%;
			width: 100%;
		}
    
        #fp-nav ul li a span{background:white}

		#enterBtn {
			background: #4BAD37;
  			border: 0px solid white;
  			border-radius: .5em;
  			padding: .5em 2em;
  			color: white;
		}

        .ui-icon-wx.ui-icon-carat-r{
            background-color: transparent!important;
            border: 0px!important;
            float: right!important;
            margin-right: 10px!important;
        }
    
        .ui-icon-wx.ui-icon-carat-r:after{
            background-image: url(style/images/share.png)!important;
            background-size: 1.5em 1.5em!important;
        }
    
        iframe{
            border:0px;
            width:100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
        }
    
		.ui-select div.ui-btn{
			padding: 0px;
  			border: 0px;
  			border-radius: 0px;
  			background: transparent;
  			box-shadow: none;
  			font-size: 12px;
  			font-weight: normal;
  			color: white;
  			text-shadow: none;
		}

		.ui-select div.ui-btn:hover{
			padding: 0px;
  			border: 0px;
  			border-radius: 0px;
  			background: transparent;
  			box-shadow: none;
  			font-size: 12px;
  			font-weight: normal;
 			color: white;
  			text-shadow: none;
		}

		.ui-select .ui-btn-icon-right:after{
			display: none;
		}

		.ui-select div.ui-btn span{
			word-wrap: break-word;
  			word-break: break-word;
  			white-space: normal!important;
		}
    
        .ui-header{
            padding-top:.5em;
        }

	</style>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script src="js/jquery.js"></script>

    <script>
    
    // 判断是否为第一次
    // 如果为第一次需要跳转到引导页
    function isFirstLogin(){
            //return true;
            return !!!window.localStorage.getItem("VERSION");
    }
    
    function hasLogin(){
        window.localStorage.setItem("VERSION",true);
    }

    function showNav(){
    	$('#global_nav').show();
    }

    function hideNav(){
    	$('#global_nav').hide();
    }
	$(function() {
		$( "[data-role='navbar']" ).navbar();
		$( "[data-role='footer']" ).toolbar();
	});   

    $( document ).on('mobileinit', function(event, ui){
                     
                     
         // 如果第一次登陆，跳转到引导页
         if( isFirstLogin()){
             //$.mobile.autoInitialize = false;
             document.location.hash = "#sy";
         }
         else{
             
         }
                                 
    })
    
    </script>
    <script src="js/jquery.mobile-1.4.5.js"></script>
    <script type="text/javascript" src="js/jquery.fullPage.min.js"></script>
</head>
<body>


<!-- 高考导航 -->
<div data-role="page" class="bg" id="gkzy">
	<div data-role="header" data-theme="a">
		<h1>高考导航</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<div class="container">
			<div class="options-row">
				<div class="options-column options-column3">
					<div class="option-name">
						<span class="h100w1"></span><lable>分数</lable>
					</div>
					<div class="option-value">
						<input data-role="none" type="number" min="0" max="750" id="gkzy_score">
					</div>
				</div>
				<div class="vertical-bar"></div>
				<div class="options-column options-column3">
					<div class="option-name">
						<span class="h100w1"></span><lable>考生省</lable>
					</div>
					<div class="option-value" id="gkzy_popup_student">
						<select>
						</select>
					</div>
				</div>
				<div class="vertical-bar"></div>
				<div class="options-column options-column3">
					<div class="option-name">
						<span class="h100w1"></span>学校省
					</div>
					<div class="option-value" id="gkzy_popup_university">
						<select>
						</select>					
					</div>						
				</div>
			</div>
			<div class="options-row">
				<div class="options-column options-column2">
					<div class="option-name">
						<span class="h100w1"></span>学科门类
					</div>
					<div class="option-value" id="gkzy_popup_category">
						<select>
						</select>		
					</div>						
				</div>
				<div class="vertical-bar"></div>
				<div class="options-column options-column2">
					<div class="option-name">
						<span class="h100w1"></span>一级学科
					</div>
					<div class="option-value" id="gkzy_popup_level1">
						<select>
						</select>					
					</div>						
				</div>
			</div>

			<p><a href="#gkzy_popup" class="ui-btn ui-shadow ui-corner-all search hide-nav" data-transition="pop" id="gkzy_search"></a></p>

			<div id="gkzy_popMsg" data-role="popup" data-overlay-theme="b" data-corners="false">
    			<a class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right" href="#" data-rel="back">Close</a>
    			<span style="color:red"></span>
			</div>

		</div>		
	</div>
</div>

<!-- 就业指导  -->
<div data-role="page" class="bg" id="zylj">
	<div data-role="header" data-theme="a">
		<h1>就业指导</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<div class="container">
			<div class="options-row">
				<div class="options-column options-column3">
					<div class="option-name">
						<span class="h100w1"></span>学科门类
					</div>
					<div class="option-value" id="zylj_popup_category">
						<select>
						</select>
					</div>						
				</div>
				<div class="vertical-bar"></div>
				<div class="options-column options-column3">
					<div class="option-name">
						<span class="h100w1"></span>一级学科
					</div>
					<div class="option-value" id="zylj_popup_level1">
						<select>
						</select>
					</div>						
				</div>
				<div class="vertical-bar"></div>
				<div class="options-column options-column3">
					<div class="option-name">
						<span class="h100w1"></span>专业名称
					</div>
					<div class="option-value" id="zylj_popup_major">
						<select>
						</select>					
					</div>						
				</div>
			</div>

			<p><a href="#zylj_popup" class="ui-btn ui-shadow ui-corner-all search hide-nav" data-transition="pop" id="zylj_search"></a></p>

			<div id="zylj_popMsg" data-role="popup" data-overlay-theme="b" data-corners="false">
    			<a class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right" href="#" data-rel="back">Close</a>
    			<span style="color:red"></span>
			</div>

		</div>		
	</div>
</div>

<!-- 职业入门 -->
<div data-role="page" class="bg" id="zyjs">
	<div data-role="header" data-theme="a">
		<h1>职业入门</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<ul data-role="listview" data-inset="true" id="zyjs_list" >
			<li>
				
			</li>
		</ul>
	</div>
</div>

<!-- 我 -->
<div data-role="page" class="bg" id="me">
	<div data-role="header" data-theme="a">
		<h1>我</h1>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<ul data-role="listview" data-inset="true" id="me_list" >
			<li><a href="#me_popup" id="about" data-transition="pop">关于我们</a></li>
			<li><a href="#me_popup" id="contact"  data-transition="pop">联系我们</a></li>
			<li><a href="#me_popup" id="copyright" data-transition="pop">版权说明</a></li>
		</ul>
	</div>
</div>

<!-- 底部导航 -->
<div id="global_nav" data-role="footer" data-position="fixed" data-fullscreen='false' data-theme="b">
	<div data-role="navbar">
		<ul>
			<li><a href="#gkzy" data-transition="slide" class="ui-btn ui-btn-active icon-zlzw icon-1" data-icon="custom">高考导航</a></li>
			<li><a href="#zylj" data-transition="slide" class="icon-zlzw icon-2" data-icon="custom">就业指导</a></li>
			<li><a href="#zyjs"  data-transition="slide" class="icon-zlzw icon-3" data-icon="custom">职业入门</a></li>
			<li><a href="#me" data-transition="slide" class="icon-zlzw icon-4" data-icon="custom">我</a></li>
		</ul>
	</div><!-- /navbar -->
</div><!-- /footer -->	

<!-- 引导页 -->
<div data-role="page" class="bg" id="sy">
    
    <div role="main" class="ui-content" style="padding:0px;">
        <div id="fullpage">
            <div class="section " id="section0">
                <div class="content">
                    <img src="style/images/guide1.png">
                        </div>
            </div>
            <div class="section" id="section1">
                <div class="content">
                    <img src="style/images/guide2.png">
                        <div style="position:absolute; bottom: 4em;	text-align: center; width: 100%">
                            <button data-role="none" id="enterBtn">立即进入</button>
                        </div>
                        </div>
            </div>
        </div>
    </div>
    
</div>

<!-- popup#gkzy_popup -->
<div data-role="page" id="gkzy_popup" class="bg">

	<div data-role="header" data-theme="a"  data-position="fixed">
		<h1 style="margin: 0px; text-align: left; width:100%;">
            <a href="#gkzy" data-rel="back" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-corner-all show-nav">返回</a>
            <a href="#gkzy_share" class="ui-btn ui-icon-wx ui-icon-carat-r ui-btn-icon-notext ui-corner-all" data-rel="popup">分享</a>
        </h1>
	</div><!-- /header -->
    
    
    <div data-role="popup" id="gkzy_share" class="share ui-content">
        <input type="button" data-icon="action" class="share-to-pengyouquan" value="分享到朋友圈">
    </div>
    

	<div role="main" class="ui-content">
		
		<ul data-role="listview" data-inset="true" id="gkzy_list">
			<li>
				
			</li>
		</ul>

	</div><!-- /content -->
</div><!-- /page popup -->

<!-- popup#zylj_popup -->
<div data-role="page" id="zylj_popup" class="bg">

	<div data-role="header" data-theme="a"  data-position="fixed">
		<h1 style="margin: 0px; text-align: left; width:100%;">
            <a href="#gkzy" data-rel="back" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-corner-all show-nav">返回</a>
            <a href="#zylj_share" class="ui-btn ui-icon-wx ui-icon-carat-r ui-btn-icon-notext ui-corner-all" data-rel="popup">分享</a>
        </h1>
    </div><!-- /header -->
    
    
    <div data-role="popup" id="zylj_share" class="share ui-content">
        <input type="button" data-icon="action" class="share-to-pengyouquan" value="分享到朋友圈">
    </div>
    
	<div role="main" class="ui-content">
		<div id="statisticsChart" style="height:400px;"></div>
		<div id="statisticsLegend">
		</div>
	</div><!-- /content -->
</div><!-- /page popup -->

<!-- popup#zyjs_popup -->
<div data-role="page" id="zyjs_popup" class="bg">

	<div data-role="header" data-theme="a"  data-position="fixed" id="zyjs_popup_header">
		<a href="#gkzy" data-rel="back" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-corner-all show-nav" style="top:1.5em;"></a>
		<h1></h1>
		<h5></h5>
	</div><!-- /header -->

	<div role="main" class="ui-content" style="background: white;">
		
	</div><!-- /content -->
</div><!-- /page popup -->

<!-- popup#me_popup -->
<div data-role="page" id="me_popup" class="bg" style="background: white!important;">
    
    <div data-role="header" data-theme="a"  data-position="fixed" id="zyjs_popup_header">
        <a href="#me" class="ui-btn ui-icon-carat-l ui-btn-icon-notext ui-corner-all show-nav" style="top:1.5em;"></a>
        <h1></h1>
        <h5></h5>
    </div><!-- /header -->
    
    <div role="main" class="ui-content" style="background: white;">
        <iframe src="" seamless="" id="me_popup_iframe"></iframe>
    </div><!-- /content -->
</div><!-- /page popup -->

<script src="js/echarts-all.js"></script>
<script type="text/javascript">

    document.addEventListener("deviceready", onDeviceReady, false);
    var hasInstalledWx = false;
    function onDeviceReady() {

    }

    function showLoading(){

        $.mobile.loading( "show", {
            text: '正在获取数据，请稍候...',
            textVisible: 'true',
            textonly: false,
            html: ''
        });
    }

    function hideLoading(){
		$.mobile.loading('hide');
    }


	function getData(id, callbackForSucc, callbackForFail){

		var url = zlzq.url[id];

		if( !url ){
		  url = id;
		}

		showLoading();

		$.ajax({
			url: url,
            type: "GET",
            dataType: "json",
            cache:true,
            crossDomain : true,
            success : function(data) {
		hideLoading();
            	callbackForSucc( data );
            },
            
            error : function(result) {
		hideLoading();
            	callbackForFail( result );
            }
		})		
	}

	function getValueSafely(item, name, value){
		if( !item[name] ){
			if( value == null || value == undefined ){
				item[name] = {};
			} else{
				item[name] = value;
			}
			
		}

		return item[name];
	}

    function changeActiveMenu( iconIdx ){
        $('.icon-zlzw').removeClass('ui-btn-active');
        $('.icon-' + iconIdx ).addClass('ui-btn-active');
    }

function refreshSelect(id, items){
    var $sel = $('#' + id).find('select');
    var opts = '';
    if( items && items.length > 0 ){
	$.each(items, function(i, item){
	    opts += '<option value="' + item + '">' + item + '</option>';
        });

    } else{
	opts = '<option></option>';
    }
    $sel.empty();
    $sel.append( opts);
    try{
	$sel.selectmenu('refresh', true);
    } catch(e){ }			
}

function adjustMePageHeight(){
    var screen = $.mobile.getScreenHeight();
    
    var $header = $("#me_popup > .ui-header");
    var $content = $("#me_popup > .ui-content");
    
    var header = $header.hasClass("ui-header-fixed") ? $header.outerHeight()  - 1 : $header.outerHeight();
    
    /* content div has padding of 1em = 16px (32px top+bottom). This step
     can be skipped by subtracting 32px from content var directly. */
    var contentCurrent = $content.outerHeight() - $content.height();
    
    var content = screen - header - contentCurrent - 5;
    
    $content.find('iframe').height(content);
}

	zlzq = {};
	// url
	zlzq.url = {};
	// url: root
	zlzq.url.root = 'http://115.29.140.45:8081/zlzw-web';
	//zlzq.url.root = 'http://192.168.1.100:8080/zlzw-web';
	// url: 高考导航
	zlzq.url.gkzy = zlzq.url.root + '/app/gkdh.action';
	// url: 就业指导
	zlzq.url.zylj = zlzq.url.root + '/app/jyzd.action';
	// url: 就业指导
	zlzq.url.zyjs = zlzq.url.root + '/app/data/zyjs.action';



	zlzq.pages = {};

	// page: 我
	zlzq.pages.sy = (function(){

		var oriData = false;

		var contents = {};

		function initView(){
		}

		function getRange(){
		}

		function load(){
            if( oriData )return;
            oriData = true;
            $('#fullpage').fullpage({
               navigation: true,
               navigationPosition: 'right'
            });
		}

		return {
			load: load
		}
	})();

	// page: 高考导航
	zlzq.pages.gkzy = (function(){

		var oriData = false;

		function initView(data){
			oriData = {};
			var kaoshengShengs = data.k;
			var xuexiaoShengs = data.x;
			var xuekes = data.xueke;
	
			// 初始化考生省
			refreshSelect('gkzy_popup_student', kaoshengShengs);
	
			// 初始化学校省
			refreshSelect('gkzy_popup_university', xuexiaoShengs);
	
			// 初始化学科门类
			var firstXueke = false;
			var currentXueke = false;
			var xueKeTypes = [];
			$.each(xuekes, function(i, xueke){
				if( !firstXueke ){
					firstXueke = xueke.xueKeType;
				}

				if( currentXueke != xueke.xueKeType ){
					currentXueke = xueke.xueKeType;
					oriData[currentXueke] = [];
					xueKeTypes.push( currentXueke );
				}

				oriData[currentXueke].push( xueke.oneXueKe );

			});
			refreshSelect('gkzy_popup_category', xueKeTypes);

			// 初始化一级学科
			refreshSelect('gkzy_popup_level1', getValueSafely(oriData, firstXueke,[] ) );

			var seleC = $('#gkzy_popup_category').find('select');	
			seleC.change(function(){
	
				var category = $(this).val();
	
				// 初始化一级学科下拉选择框
				refreshSelect('gkzy_popup_level1', getValueSafely(oriData, category, [] ) );

			});
			$('#gkzy_search').click(function(e){
		
				var errMsg = false;
				var range = getRange();

				console.log( range )
		
				if( !$.isNumeric(range.score) ){
					errMsg = '分数必须为整数！';
				} 
				else if( !range.student ){
					errMsg = '请选择考生所在省！';
				}
				else if( !range.university ){
					errMsg = '请选择学校所在省！';
				}
				else if( !range.category ){
					errMsg = '请选择学科门类！';
				}
				else if( !range.student ){
					errMsg = '请选择一级学科！';
				}
		
				if( errMsg ){
					$('#gkzy_popMsg').find('span').html(errMsg);
					$('#gkzy_popMsg').popup('open');
					$(this).removeClass('ui-btn-active'); // 此时已经带有.ui-btn-active
					return false;
				} else{
					var url = zlzq.url.root + '/app/data/gkdh.action?';
					url += 'score=' + range.score + '&';
					url += 'src=' + range.student + '&';
					url += 'dest=' + range.university + '&';
					url += 'type=' + range.category + '&';
					url += 'level1=' + range.level1 + '&';

					getData(url, function(data){

						var list = $('#gkzy_list');
						list.empty();	
						var rows = data.result;
						if( rows ){
							var lis = '';
							$.each(rows, function(i, item){
								lis += '<li>学&nbsp;校：' + item.schoolName 
									     + '<br>平均分：' + item.score 
										 + '<br>专&nbsp;业：' + item.oneXueKe + ' 	- ' + item.zhuanYe 
										 + '</li>';
	
							});
							list.append( lis );
						}
						try{
							list.listview('refresh');
						} catch(e){
	
						}
					});

				}
			});


		}

		function getRange(){
			var scoreEle = $('#gkzy_score');
			var studentEle = $('#gkzy_popup_student').find('select');
			var universityEle = $('#gkzy_popup_university').find('select');
			var categoryEle = $('#gkzy_popup_category').find('select');
			var level1Ele = $('#gkzy_popup_level1').find('select');
			
			var range = {};

			range.score = scoreEle.val();
			range.student = studentEle.val();
			range.university = universityEle.val();
			range.category = categoryEle.val();
			range.level1 = level1Ele.val();
		
			return range;

		}

		function load(){
			if( oriData )return;
			getData('gkzy', 
				function(data) {
        		 	initView(data);
        		}, 
        		function(result) {
        		 	console.log( result )
        		}
        	);	
		}

		return {
			load: load
		}
	})();

	// page: 就业指导
	zlzq.pages.zylj = (function(){

		var oriData;

		var industries = {};

		var statisticsChart = false;

		var statisticsLegend = false;

		var colors = [ 'rgb(138,213,240)', 'rgb(197,226,109)', 'rgb(255,217,128)', 'rgb(255,148,148)', 'rgb(214,173,235)', 'rgb(29,169,218)', 'rgb(179,104,207)', 'rgb(131,182,0)', 'rgb(255,167,15)', 'rgb(233,39,39)'];

		var currentRows = false; // 当前待加载的数据

		function initView(data){

			var rows = data.xueke;

			var categorySele = $('#zylj_popup_category').find('select');
			var level1Sele = $('#zylj_popup_level1').find('select');
			var majorSele = $('#zylj_popup_major').find('select');
	
			oriData = {};
			oriData.dict1 = {};
			oriData.dict2 = {};
			var curType = false;
			var curOne = false;
			var types = [];
			$.each(rows, function(i,z){
				var type = z.xueKeType;
				var one = z.oneXueKe;
				var zhuanYe = z.zhuanYe;

				if( type != curType ){
					curType = type;
					oriData.dict1[curType] = [];
					types.push( curType );
					curOne = false;
				}

				if( one != curOne ){
					curOne = one;
					oriData.dict2[curType + "-" + curOne] = [];
					oriData.dict1[curType].push( curOne );
				}

				oriData.dict2[curType + "-" + curOne].push( zhuanYe );
			});

			curType = types[0];
			curOne = oriData.dict1[curType][0];
			refreshSelect('zylj_popup_category', types);
			refreshSelect('zylj_popup_level1', oriData.dict1[curType]);
			refreshSelect('zylj_popup_major', oriData.dict2[curType + "-" + curOne]);
	
			categorySele.change(function(){
				var currentCategory = $(this).val();
				var level1s = oriData.dict1[currentCategory];
				refreshSelect('zylj_popup_level1', level1s);
				var majors = getValueSafely(oriData.dict2, currentCategory + "-" + level1s[0], [])
				refreshSelect('zylj_popup_major', majors);
			});
	
			level1Sele.change(function(){
				var range = getRange();
                                var majors = getValueSafely(oriData.dict2, range.category + "-" + range.level1, [])
                                refreshSelect('zylj_popup_major', majors);
			});

			$('#zylj_search').click(function(e){

				var errMsg = false;
				var range = getRange();
		
				if( !range.category ){
					errMsg = '请选择学科门类！';
				}
				else if( !range.level1 ){
					errMsg = '请选择一级学科！';
				}
				else if( !range.major ){
					errMsg = '请选择专业！';
				}
				if( errMsg ){
					$('#zylj_popMsg').find('span').html(errMsg);
					$('#zylj_popMsg').popup('open');
					$(this).removeClass('ui-btn-active'); // 此时已经带有.ui-btn-active
					return false;
				} else{
			
					var rows = industries[range.category][range.level1][range.major];
					currentRows = rows;
				}
			});
		}

		function getRange(){
			var categorySele = $('#zylj_popup_category').find('select');
			var level1Sele = $('#zylj_popup_level1').find('select');
			var majorSele = $('#zylj_popup_major').find('select');
			return {
				category : categorySele.val(),
				level1: level1Sele.val(),
				major: majorSele.val()
			}
		}

		function createChart(){

			if( statisticsChart ){
				statisticsChart.clear();
			} else{
				// 将div设置为正方形
				var chartContainer = $('#statisticsChart');
				chartContainer.height( chartContainer.width() );
            	var option = {
            	    title: {
            	        show: false // 不显示标题
            	    },
            	    legend: {
            	        show: false, // 不显示图例
            	        data: []
            	    },
            	    color: colors
            	}
	
				statisticsChart = echarts.init( document.getElementById('statisticsChart'));
	
				statisticsChart.setOption( option );

				// 
				statisticsLegend = $('#statisticsLegend');

				
			}
			
			//setChartSeries(currentRows);
			var range = getRange();
			var url = zlzq.url.root + '/app/data/jyzd.action?';
			url += 'type=' + range.category + '&';
			url += 'level1=' + range.level1 + '&';
			url += 'zhuanye=' + range.major + '&';
			getData(url, function(data){
				var currentRows = {};
				var rows = data.result;
				var total = 0;
				$.each(rows , function(i, row){
					total += row.count;
					currentRows[row.name] = {};
					currentRows[row.name].v = row.count;
				});
				$.each(currentRows, function(i, row){
					row.r = parseFloat( (row.v*100/total).toFixed(2));
				});
				currentRows.total = total;
				setChartSeries(currentRows);
			});
		}

		function setChartSeries(rows){
			var data = [];
			var other = 0;
			var otherr = 100;
			var colorIdx = 0;
			var legendHtml = '';

			$.each(rows, function(h, r){
				if( h == 'total' )return;
				// 小于3%都归到其他里
				if( r.r <= 3 ){
					other += r.v;
				} else{
					otherr -= r.r;
					var legend = h + ' - ' + r.r + '%';
					data.push({
						name: legend,
						value: r.v
					});

					legendHtml = pushLegendHtml(colorIdx++, legend, legendHtml);
				}
			});

			if( other > 0 ){
				var legend = '其他'+ ' - ' + otherr.toFixed(2) + '%';
				data.push({
					name: legend,
					value: other
				});

				legendHtml = pushLegendHtml(colorIdx++, legend, legendHtml);
			}

			//---- chart
			statisticsChart.setOption({
				color: colors
			})
            statisticsChart.setSeries([{
                name: '就业指导',
                type: 'pie',
                radius : '90%',
                center: ['50%', '50%'],
                itemStyle :　{
                    normal : {
                        label : {
                        	show: false
                        },
                        labelLine : {
                            show : false
                        }
                    }
                },
                data:data                  
            }]);

            //---- legend

            statisticsLegend.empty();	
            statisticsLegend.html(legendHtml);		
		}

		function pushLegendHtml(colorIdx, legend, html){

			var colorRange = colors.length;
			var color = colors[colorIdx % colorRange];

			html += '<div style="color:' + color + '"><span class="legend-color"> ■ </span><span class="legend-text">' + legend + '</span></div>';

			return html;
		}

		function load(){
			if( oriData )return;

			getData('zylj', 
				function(data) {
        		 	initView(data);
        		}, 
        		function(result) {
        		 	console.log( result )
        		}
        	);	
		}

		return {
			load: load,
			createChart: createChart
		}
	})();

	// page: 就业指导
	zlzq.pages.zyjs = (function(){

		var oriData;

		function initView(data){

			var contents = data.result;
			popupPage = $('#zyjs_popup');
	
	
			list = $('#zyjs_list');
	
			var lis = '';
			$.each(contents, function(i, zhiye){
	
				lis += '<li><a href="#zyjs_popup" data-transition="pop" class="jump-content hide-nav" content=' + zhiye.id + '><span class="desc">文章简介：' + zhiye.introduction + '</span><br>'
					 + '<h1 class="title">' + zhiye.title + '</h1>'
					 + '<span class="author">作者：' + zhiye.author + '</span></a></li>';
	
			})
			list.append( lis );
			list.listview('refresh');
	
	
			$('.jump-content').click(function(e){
				var id =  $(this).attr('content') ;
				var title = $(this).find('.title').html();
				var author = $(this).find('.author').html();
				var url = zlzq.url.root + '/app/data/zyjsArticle.action?id=' + id;
				getData(url, function(data){
					var content = data.result;
					$('#zyjs_popup').find('.ui-content').html( content );
					$('#zyjs_popup_header').find('h1').html( title );
					$('#zyjs_popup_header').find('h5').html( author );
					$.mobile.changePage( "#zyjs_popup");
				});
			});

		}

		function getRange(){
		}

		function load(){

			if( oriData )return;
                       
			getData('zyjs', 
				function(data) {
        		 	oriData = true;
        		 	initView(data);
        		}, 
        		function(result) {
        		 	console.log( result )
        		}
        	);	
		}

		return {
			load: load
		}
	})();

	// page: 我
	zlzq.pages.me = (function(){

		var oriData;

		var contents = {};

		function initView(){
                     
            $('#me_list > li > a').click(function(e){
               var id = $(this).attr('id');
               $('#me_popup_iframe').attr('src', 'http://115.29.140.45:8081/zlzw-web/app/' + id + '.html');
                                        
            })
		}

		function getRange(){
		}

		function load(){
                     
            if( oriData )return;
            initView();
            oriData=true;
                
		}

		return {
			load: load
		}
	})();



	//---- 事件绑定 ----//
	$( document ).on('pagechange',function(event, ui){
		var pid = ui.toPage.attr('id');

		if( pid == 'gkzy' ){
			changeActiveMenu("1");
		} else if( pid == 'zylj' ){
			changeActiveMenu("2");
		} else if( pid == 'zyjs' ){
			changeActiveMenu("3");
		} else if( pid == 'me' ){
			changeActiveMenu("4");
		} else if( pid == 'sy' ){
		}

		console.log( 'pagechange -> ' + pid );
		if( zlzq.pages[pid] ){
            // 如果是“我”页面，调整弹出页面为60%
            if( pid == 'me' ){
                $('.ui-ext-url').height( $(document).height() * 0.6 );
                     
            }
			zlzq.pages[pid].load();
		} 
		// 创建统计图
		else if(  pid == 'zylj_popup' ){
			zlzq.pages['zylj'].createChart();
		}

	});

	//---- 事件绑定 ----//
	$( document ).on('pagebeforeshow',function(event, ui){
		var pid = event.target.id;

		if( pid == 'gkzy' ){
			showNav();
		} else if( pid == 'zylj' ){
			showNav();
		} else if( pid == 'zyjs' ){
			showNav();
		} else if( pid == 'me' ){
			showNav();
		} else {
			hideNav();
		}
	});

	// 分享
	$( document ).on('tap', '.ui-icon-wx', function(){
		console.log( 'share to wx' );
        $( ".share" ).popup( "option", "align","1,0");
	});
    
    //
    $( document ).on('tap', '.share-to-pengyouquan', function(){
        console.log('peng you quan');
        Wechat.share({
          message: {
             title: "职学帮",
             description: "选志愿 看前景 一站式搞定",
             messageExt: "选志愿 看前景 一站式搞定",
                     thumb: "http://115.29.140.45:8081/zlzw-web/app/xue.png",
                     media: {
                     type: Wechat.Type.LINK,
                     webpageUrl: "http://115.29.140.45:8081/zlzw-web/app/download.html"
                     }
          },
           scene: Wechat.Scene.TIMELINE   // share to Timeline
          }, function () {
                 //alert("Success");
            }, function (reason) {
                 //alert("Failed: " + reason);
        });
    });
    
    $( document ).on('tap', '.icon-zlzw', function(){
        var iconIdx = $(this).data('icon-idx');
        var $this = $(this);
        if($this.hasClass('icon-1')){
           iconIdx = "1";
        } else if($this.hasClass('icon-2')){
           iconIdx = "2";
        } else if($this.hasClass('icon-3')){
            iconIdx = "3";
        } else if($this.hasClass('icon-4')){
             iconIdx = "4";
        }
                     
        changeActiveMenu(iconIdx);
    });
                     
	// 首页进入
	$('#enterBtn').on('tap', function(){
		console.log( 'enter to main' );
		hasLogin();
        $('#fp-nav').remove();
		$( ":mobile-pagecontainer" ).pagecontainer('change', '#gkzy');
	});


    $(document).delegate('#me_popup', 'pageshow', function () {
        adjustMePageHeight();
    });
                     
</script>

</body>
</html>
